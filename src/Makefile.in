# Makefile.in -- input for the src directory's Makefile
# $Id$
#
# Copyright (C) 1999 John Harper <john@dcs.warwick.ac.uk>
#
# This file is part of sawmill.
#
# sawmill is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# sawmill is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with sawmill; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.

include ../Makedefs

top_builddir=..
top_srcdir=@top_srcdir@
srcdir=@srcdir@
VPATH=@top_srcdir@/src:.

SRCS :=	colors.c commands.c cursors.c display.c events.c fonts.c frames.c \
	functions.c images.c keys.c main.c windows.c
OBJS := $(SRCS:.c=.o)

DL_SRCS := server.c
DL_OBJS := $(DL_SRCS:%.c=lib%.la)

CFLAGS := $(CFLAGS) $(IMLIB_CFLAGS) $(X11_CFLAGS)

all : sawmill sawmill-client $(DL_OBJS)

sawmill : $(OBJS) $(LIBOBJS)
	$(rep_LIBTOOL) $(CC) -export-dynamic $(LDFLAGS) \
	  -o sawmill $(OBJS) $(LIBOBJS) $(IMLIB_LIBS) $(X11_LIBS) $(LIBS)

sawmill-client : client.o
	$(CC) $(LDFLAGS) -o $@ $< $(LIBOBJS) $(LIBS)

libserver.la : server.lo
	$(rep_DL_LD) $(LDFLAGS) -o $@ $<

install : all installdirs
	for p in sawmill sawmill-client; do \
	  $(rep_LIBTOOL) $(INSTALL_PROGRAM) $$p ${bindir}; \
	done
	for p in $(DL_OBJS); do \
	  $(rep_DL_INSTALL) $$p ${sawmillexecdir}; \
	done

uninstall :
	for p in sawmill; do \
	  $(rep_LIBTOOL) rm ${bindir}/$$p; \
	done
	for p in $(DL_OBJS); do \
	  $(rep_DL_UNINSTALL) ${sawmillexecdir}/$$p; \
	done

installdirs : $(top_srcdir)/mkinstalldirs
	$(SHELL) $(top_srcdir)/mkinstalldirs $(bindir) $(sawmillexecdir)

clean :
	rm -f *~ *.o *.lo *.la build.h core

realclean : clean
	rm -f .*.d sawmill sawmill-client Makefile
	rm -rf .libs

include $(SRCS:%.c=.%.d) $(DL_SRCS:%.c=.%.d)
