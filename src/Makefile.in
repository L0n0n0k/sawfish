# Makefile.in -- input for the src directory's Makefile
# $Id$
#
# Copyright (C) 1999 John Harper <john@dcs.warwick.ac.uk>
#
# This file is part of sawmill.
#
# sawmill is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
#
# sawmill is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with sawmill; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.

include ../Makedefs

top_builddir=..
top_srcdir=@top_srcdir@
srcdir=@srcdir@
VPATH=@top_srcdir@/src:.

SRCS :=	colors.c commands.c cursors.c display.c events.c fonts.c frames.c \
	functions.c images.c keys.c main.c server.c session.c windows.c
OBJS := $(SRCS:.c=.o)

DL_SRCS := gradient.c flippers.c x.c selection.c
DL_OBJS := $(DL_SRCS:%.c=%.la)

LISP_SRCS := sawmill-ui.jl sawmill-menu.jl
LISP_OBJS := $(LISP_SRCS:.jl=.jlc)

override CFLAGS := $(CFLAGS) $(REP_CFLAGS) $(IMLIB_CFLAGS) $(X11_CFLAGS)

all : sawmill sawmill-client libclient.o $(DL_OBJS) $(LISP_OBJS) gtk-style

sawmill : $(OBJS) $(LIBOBJS)
	$(rep_LIBTOOL) $(CC) -export-dynamic $(LDFLAGS) \
	  -o sawmill $(OBJS) $(LIBOBJS) $(REP_LIBS) \
	  $(IMLIB_LIBS) $(X11_LIBS) $(LIBS)

sawmill-client : client.o libclient.o
	$(CC) $(LDFLAGS) -o $@ $^ $(LIBOBJS) $(X11_LIBS) $(READLINE_LIBS) $(LIBS)

%.la : %.lo
	$(rep_DL_LD) $(LDFLAGS) -o $@ $<

%.jlc : %.jl
	REP_GTK_DONT_INITIALIZE=1 rep compiler -f compile-batch $<

gtk-style : gtk-style.c
	$(CC) $(CPPFLAGS) $(GTK_CFLAGS) $(LDFLAGS) -o $@ $< $(GTK_LIBS) $(LIBS)

install : all installdirs
	for p in sawmill sawmill-client; do \
	  $(rep_LIBTOOL) $(INSTALL_PROGRAM) $$p $(DESTDIR)${bindir}; \
	done
	for p in gtk-style $(DL_OBJS); do \
	  $(rep_DL_INSTALL) $$p $(DESTDIR)${sawmillexecdir}; \
	done
	$(INSTALL_SCRIPT) sawmill-ui.jlc $(DESTDIR)$(bindir)/sawmill-ui
	$(INSTALL_SCRIPT) sawmill-menu.jlc $(DESTDIR)$(sawmillexecdir)/sawmill-menu
	if [ -f $(DESTDIR)$(bindir)/sawmill-menu ]; then \
	  rm -f $(DESTDIR)$(bindir)/sawmill-menu; \
	fi

uninstall :
	for p in sawmill sawmill-client; do \
	  $(rep_LIBTOOL) rm $(DESTDIR)${bindir}/$$p; \
	done
	for p in gtk-style $(DL_OBJS); do \
	  $(rep_DL_UNINSTALL) $(DESTDIR)${sawmillexecdir}/$$p; \
	done
	rm -f $(DESTDIR)${bindir}/sawmill-ui
	rm -f $(DESTDIR)${sawmillexecdir}/sawmill-menu

installdirs : $(top_srcdir)/mkinstalldirs
	$(SHELL) $(top_srcdir)/mkinstalldirs $(DESTDIR)$(bindir) \
	  $(DESTDIR)$(sawmillexecdir)

clean :
	rm -f *~ *.o *.lo *.la build.h core

realclean : clean
	rm -f .*.d sawmill sawmill-client Makefile *.jlc gtk-style
	rm -rf .libs

include $(SRCS:%.c=.%.d) $(DL_SRCS:%.c=.%.d)
